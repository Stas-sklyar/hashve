<app-header [showMobileMenu]="false" [showSlider]="showSlider"></app-header>

<main>
  <div class="st-width-full">
    <span
      *ngIf="!pack.baseItem.inStock || !store?.inStock(pack.baseItem._id)"
      class="btn btn--middle btn--orange"
      >{{ "המוצר לא במלאי" | translate }}</span
    >
    <div
      class="payment"
      *ngIf="pack.baseItem.inStock && store?.inStock(pack.baseItem._id)"
    >
      <div class="payment-scroll d-none d-md-block" id="payment-scroll">
        <div class="payment-scroll-price">
          <div class="payment-scroll-price__title">
            {{ "payment.form.sumForPayment" | translate }}
          </div>
          <div class="payment-scroll-price__price">
            ₪{{ store.getPackagePriceWithDelivery(pack, city._id) }}
          </div>
        </div>

        <div
          class="warning-clock-line"
          *ngIf="pack.baseItem.isPriceImproveValid()"
        >
          <img
            src="/assets/img/icon-clock-big.png"
            alt=""
            class="warning-clock__img"
          />

          <div class="warning-clock-line__text">
            <span class="warning-clock-line__title"
              >{{ "payment.offer" | translate }}
            </span>
            <span class="warning-clock-line__time"
              >{{ state.minutes }} {{ "payment.min" | translate }}
              {{ state.seconds }}</span
            >
          </div>
        </div>
        <div
          class="warning-clock-line warning-clock-line--red d-md-none"
          *ngIf="
            !pack.baseItem.isPriceImproveValid() &&
            pack.baseItem.improvePriceRequest
          "
        >
          <img
            src="/assets/img/icon-clock.png"
            alt=""
            class="warning-clock__img"
          />

          <div class="warning-clock-line__text">
            <span class="warning-clock-line__title"
              >{{ "payment.offerClosed" | translate }}
            </span>
          </div>
        </div>
      </div>

      <div id="position-fixedpayment"></div>

      <div class="payment-form-type d-none d-md-flex">
        <span class="-type__title">{{ "payment.check" | translate }}</span>
        <a
          class="btn"
          [ngClass]="{
            'btn--border-green':
              orderForm.get('deliveryDetails.deliveryType').value !==
              _deliveryType.delivery
          }"
          (click)="setDeliveryTypeValue(_deliveryType.delivery)"
          >{{ "payment.deliveryBtn" | translate }}</a
        >
        <a
          class="btn"
          [ngClass]="{
            'btn--border-green':
              orderForm.get('deliveryDetails.deliveryType').value !==
              _deliveryType.pickup
          }"
          (click)="setDeliveryTypeValue(_deliveryType.pickup)"
          >{{ "payment.pickup" | translate }}</a
        >
      </div>

      <div class="payment__notice d-none d-md-block">
        {{ "payment.paymentNotice" | translate }}
      </div>

      <div class="payment__offer">
        <div class="payment-offer {{ menuFixed }}">
          <div class="payment-offer__head">
            {{ "payment.orderDetail" | translate }}
            <span class="payment-offer__head-name d-none d-md-block"
              ><span class="payment-offer__head-title"
                >{{ "payment.storePerforms" | translate }} </span
              >{{ store.name[curLang] }}</span
            >
          </div>

          <div class="payment-offer__item d-md-none">
            <div class="payment-offer__product">
              <span class="payment-offer__product-name">{{
                store.name[curLang]
              }}</span>
              <span class="payment-offer__invite"
                ><span class="payment-offer__invite-num">{{
                  store.reviewsCount
                }}</span>
                {{ "payment.orders" | translate }}
              </span>
              <span class="payment-offer__rating"
                ><span class="payment-offer__rating-num">{{
                  store.rating
                }}</span>
                {{ "payment.rating" | translate }}</span
              >
            </div>

            <div class="payment-offer__address">
              {{ store.address[curLang] }}
            </div>
            <div class="payment-offer__notice">
              {{ "payment.orderNotice" | translate }}
            </div>

            <div
              class="payment-offer-privilege"
              *ngIf="
                !pack.tmp ||
                pack.baseItem.isPriceImproveValid() ||
                pack.baseItem.isDayDeal() ||
                pack.baseItem.isSale()
              "
            >
              <div class="payment-offer-privilege__head">
                {{ "payment.deal" | translate }}
              </div>
              <div class="payment-offer-privilege__text">
                <ng-container
                  *ngIf="pack.tmp && pack.baseItem.isPriceImproveValid()"
                >
                  *<span class="payment-offer-privilege__text-color">{{
                    "citySearch.item.priceImprove" | translate
                  }}</span>
                  <span class="payment-offer-privilege__price"
                    >₪{{
                      store.getPriceOfPackWithoutDiscountWithDelivery(
                        pack,
                        city._id
                      ) - store.getPackagePriceWithDelivery(pack, city._id)
                    }}</span
                  >
                </ng-container>
                <ng-container *ngIf="pack.tmp && pack.baseItem.isDayDeal()"
                  >*<span class="payment-offer-privilege__text-color">{{
                    "citySearch.item.dayDeal" | translate
                  }}</span>
                </ng-container>
                <ng-container *ngIf="pack.tmp && pack.baseItem.isSale()"
                  >*<span class="payment-offer-privilege__text-color">{{
                    "citySearch.item.sale" | translate
                  }}</span>
                </ng-container>
              </div>
            </div>
          </div>

          <div class="payment-offer__item">
            <div class="payment-offer__title d-md-none">
              {{ "payment.orderDetails" | translate }}
            </div>

            <div class="payment-offer-list">
              <div class="payment-offer-list__item">
                <div class="payment-offer-list__desc">
                  <div
                    class="payment-offer-list__img"
                    [style.backgroundImage]="
                      'url(' +
                      host +
                      '/assets/items/' +
                      pack.baseItem.picture +
                      ')'
                    "
                  ></div>

                  <div class="payment-offer-list__name">
                    {{ "citySearch.item.code" | translate }}
                    {{ pack.baseItem.code }}
                  </div>
                  <div
                    class="sticker"
                    [ngClass]="{
                      'sticker--purple': pack.size === _ItemSize.extralarge,
                      'sticker--blue': pack.size === _ItemSize.large
                    }"
                  >
                    <div class="sticker__label">גודל</div>
                    <div class="sticker__text">
                      {{ sizeArray[pack.size][curLang] }}
                    </div>
                  </div>
                </div>

                <div class="payment-offer-list__price">
                  <span class="payment-offer-list__currency">₪</span
                  >{{
                    store.getPriceById(pack.baseItem._id) +
                      pack.size +
                      (orderForm.get("deliveryDetails.deliveryType").value ===
                      _deliveryType.pickup
                        ? 0
                        : store.getDeliveryPrice(city._id))
                  }}
                </div>
              </div>

              <div
                class="payment-offer-list__item"
                *ngFor="let item of pack.addItems"
              >
                <div class="payment-offer-list__desc">
                  <div
                    class="payment-offer-list__img"
                    [style.backgroundImage]="
                      'url(' + host + '/assets/items/' + item.picture + ')'
                    "
                  ></div>

                  <div class="payment-offer-list__name">
                    {{ item.name[curLang] }}
                  </div>
                </div>

                <div class="payment-offer-list__price">
                  {{ store.getPrice(item) }}
                  <span class="payment-offer-list__currency">₪</span>
                </div>
              </div>
            </div>
            <!-- end payment-offer-list -->
          </div>

          <div class="payment-offer__item">
            <div class="payment-offer__title d-md-none">
              {{ "payment.finalSum" | translate }}
            </div>

            <div class="payment-offer-result">
              <div class="payment-offer-result__item">
                <div class="payment-offer-result__title">
                  {{ "payment.sum" | translate }}
                </div>
                <div class="payment-offer-result__price">
                  {{
                    store.getPriceOfPackWithoutDiscount(pack) +
                      (orderForm.get("deliveryDetails.deliveryType").value ===
                      _deliveryType.pickup
                        ? 0
                        : store.getDeliveryPrice(city._id))
                  }}
                  <span class="payment-offer-result__currency">₪</span>
                </div>
              </div>

              <div class="payment-offer-result__item">
                <div class="payment-offer-result__title">
                  {{ "payment.deal" | translate }}:
                </div>
                <div
                  class="payment-offer-result__label payment-offer-result__label--color d-none d-md-block"
                  *ngIf="pack.tmp && pack.baseItem.isPriceImproveValid()"
                >
                  {{ "citySearch.item.priceImprove" | translate }}
                </div>
                <div
                  class="payment-offer-result__label payment-offer-result__label--color d-none d-md-block"
                  *ngIf="pack.tmp && pack.baseItem.isDayDeal()"
                >
                  {{ "citySearch.item.dayDeal" | translate }}
                </div>
                <div
                  class="payment-offer-result__label payment-offer-result__label--color d-none d-md-block"
                  *ngIf="pack.tmp && pack.baseItem.isSale()"
                >
                  {{ "citySearch.item.sale" | translate }}
                </div>

                <div
                  class="payment-offer-result__price payment-offer-result__price--green"
                >
                  {{
                    store.getPackagePriceWithDelivery(pack, city._id) -
                      store.getPriceOfPackWithoutDiscountWithDelivery(
                        pack,
                        city._id
                      )
                  }}
                  <span class="payment-offer-result__currency">₪</span>
                </div>
              </div>

              <div class="payment-offer-result__item">
                <div
                  class="payment-offer-result__title"
                  *ngIf="
                    orderForm.get('deliveryDetails.deliveryType').value ===
                    _deliveryType.delivery
                  "
                >
                  {{ "payment.delivery" | translate }}
                </div>
                <div
                  class="payment-offer-result__title"
                  *ngIf="
                    orderForm.get('deliveryDetails.deliveryType').value ===
                    _deliveryType.pickup
                  "
                >
                  {{ "payment.pickup" | translate }}
                </div>

                <div class="payment-offer-result__label">
                  {{
                    orderForm.get("deliveryDetails.deliveryType").value ===
                    _deliveryType.pickup
                      ? ""
                      : city.name[curLang]
                  }}
                </div>
                <div class="payment-offer-result__price">
                  <span
                    class="payment-offer-result__currency"
                    *ngIf="
                      orderForm.get('deliveryDetails.deliveryType').value ===
                      _deliveryType.delivery
                    "
                    >{{ "payment.deliveryIncluded" | translate }}</span
                  >
                </div>
              </div>

              <div class="payment-offer-result__item">
                <div class="payment-offer-result__title">
                  {{ "payment.form.sumForPayment" | translate }}
                </div>

                <div class="payment-offer-result__price">
                  {{
                    orderForm.get("deliveryDetails.deliveryType").value ===
                    _deliveryType.pickup
                      ? store.getPackagePrice(pack)
                      : store.getPackagePriceWithDelivery(pack, city._id)
                  }}
                  <span class="payment-offer-result__currency">₪</span>
                </div>
              </div>
            </div>
          </div>

          <div class="payment-offer__item d-md-none">
            <div class="payment-offer__result">
              {{ "payment.saved" | translate }}
              {{
                store.getPriceOfPackWithoutDiscountWithDelivery(
                  pack,
                  city._id
                ) - store.getPackagePriceWithDelivery(pack, city._id)
              }}
              <span class="payment-offer__result-price">₪</span>
            </div>
          </div>

          <div
            class="warning-clock-line"
            *ngIf="pack.baseItem.isPriceImproveValid()"
          >
            <img
              src="/assets/img/icon-clock-big.png"
              alt=""
              class="warning-clock__img"
            />

            <div class="warning-clock-line__text">
              <span class="warning-clock-line__title"
                >{{ "payment.offer" | translate }}
              </span>
              <span class="warning-clock-line__time"
                >{{ state.minutes }} {{ "payment.min" | translate }}
                {{ state.seconds }} {{ "payment.sec" | translate }}</span
              >
            </div>
          </div>
          <div
            class="warning-clock-line warning-clock-line--red d-md-none"
            *ngIf="
              !pack.baseItem.isPriceImproveValid() &&
              pack.baseItem.improvePriceRequest
            "
          >
            <img
              src="/assets/img/icon-clock.png"
              alt=""
              class="warning-clock__img"
            />

            <div class="warning-clock-line__text">
              <span class="warning-clock-line__title"
                >{{ "payment.offerClosed" | translate }}
              </span>
            </div>
          </div>
        </div>
      </div>
      <!-- end payment__offer -->

      <div class="payment__content">
        <div class="payment-form">
          <form
            [formGroup]="orderForm"
            (ngSubmit)="saveOrder($event)"
            class="form-site"
          >
            <ng-container *ngIf="step === 1">
              <div class="form-site__sect d-md-none">
                <div class="form-site__notice">
                  {{ "payment.paymentNotice" | translate }}
                </div>
              </div>

              <div class="form-site__sect d-md-none">
                <div class="payment-form-type">
                  <span class="payment-form-type__title">{{
                    "payment.deliveryType" | translate
                  }}</span>
                  <a
                    class="btn"
                    [ngClass]="{
                      'btn--border-green':
                        orderForm.get('deliveryDetails.deliveryType').value !==
                        _deliveryType.delivery
                    }"
                    (click)="setDeliveryTypeValue(_deliveryType.delivery)"
                    >{{ "payment.deliveryBtn" | translate }}</a
                  >
                  <a
                    class="btn"
                    [ngClass]="{
                      'btn--border-green':
                        orderForm.get('deliveryDetails.deliveryType').value !==
                        _deliveryType.pickup
                    }"
                    (click)="setDeliveryTypeValue(_deliveryType.pickup)"
                    >{{ "payment.pickup" | translate }}</a
                  >
                </div>
              </div>

              <!-- <div class="form-site__sect d-md-none">
              <div class="payment-form-welcome"><span class="payment-form-welcome__text">שלום רומן!</span> <a href="#">עדכן
                פרופיל</a></div>
            </div> -->

              <!--<div class="form-site__sect d-none d-md-block">
                <div class="payment-form-auth">למעקב אחר הזמנה <span class="payment-form-auth__link">
                  <a href="#">התחברות </a>/<a href="#">הרשמה</a></span></div>
              </div>-->

              <div class="payment-form-step__head d-md-none">
                {{ "payment.form.formTitle" | translate }}
              </div>

              <div
                class="payment-form-step__item"
                formGroupName="customerDetails"
              >
                <div
                  class="payment-form-step__title"
                  [ngStyle]="{
                    color: f.customerDetails.valid ? 'green' : 'red'
                  }"
                >
                  {{ "payment.form.customerData" | translate }}
                </div>

                <div class="payment-form-step__form">
                  <div class="form-site__field">
                    <label for="name" class="form-site__label"
                      >*{{ "payment.form.fullName" | translate }}</label
                    >
                    <input
                      type="text"
                      formControlName="fullName"
                      placeholder="הזינו שם\חברה להציג בחשבונית"
                      id="name"
                    />
                    <span
                      class="form-site__error"
                      *ngIf="!f.customerDetails.get('fullName').valid"
                    >
                      {{
                        "payment.form.validationErrors.requiredCustomerFullName"
                          | translate
                      }}
                    </span>
                  </div>

                  <div class="form-site__field">
                    <label for="phone" class="form-site__label"
                      >*{{ "payment.form.mobile" | translate }}</label
                    >
                    <input
                      type="text"
                      formControlName="mobile"
                      placeholder=""
                      id="phone"
                    />
                    <span
                      class="form-site__error"
                      *ngIf="!f.customerDetails.get('mobile').valid"
                    >
                      {{
                        "payment.form.validationErrors.requiredCustomerPhone"
                          | translate
                      }}
                    </span>
                  </div>

                  <div class="form-site__field">
                    <label for="mail" class="form-site__label"
                      >*{{ "payment.form.mail" | translate }}</label
                    >
                    <input
                      type="email"
                      formControlName="email"
                      placeholder="example@gmail.com"
                      id="mail"
                    />
                    <span
                      class="form-site__error"
                      *ngIf="!f.customerDetails.get('email').valid"
                    >
                      {{
                        "payment.form.validationErrors.requiredCustomerMail"
                          | translate
                      }}
                    </span>
                  </div>

                  <!-- <div class="input-check">
                                        <input type="checkbox" formControlName="invoice" id="checkbox1" checked="checked">
                                        <label for="checkbox1" class="input-check__label"><span class="input-check__mark"></span><span
                      class="input-check__text">{{ "payment.form.sendInvoice" | translate }}</span></label>
                                    </div> -->

                  <div
                    class="form-site__fields-wrap"
                    *ngIf="orderForm.get('customerDetails.invoice').value"
                  >
                    <div class="form-site__field">
                      <label for="company" class="form-site__label">{{
                        "payment.form.companyName" | translate
                      }}</label>
                      <input
                        type="text"
                        formControlName="companyName"
                        placeholder=""
                        id="company"
                      />
                    </div>

                    <div class="form-site__field">
                      <label for="website" class="form-site__label">{{
                        "payment.form.address" | translate
                      }}</label>
                      <input
                        type="text"
                        formControlName="address"
                        placeholder=""
                        id="website"
                      />
                    </div>
                  </div>
                </div>
              </div>

              <!-- isuf acmi pratim start -->
              <div
                class="payment-form-step__item"
                formGroupName="deliveryDetails"
                *ngIf="
                  orderForm.get('deliveryDetails.deliveryType').value ===
                  _deliveryType.pickup
                "
              >
                <div
                  class="payment-form-step__title"
                  [ngStyle]="{
                    color:
                      f.deliveryDetails.get('date').valid &&
                      f.deliveryDetails.get('hours').valid
                        ? 'green'
                        : 'red'
                  }"
                >
                  {{ "payment.form.pickupDetails" | translate }}
                </div>

                <div class="payment-form-step__form">
                  <div class="p-field p-col-12 p-md-4" dir="rtl">
                    <p-calendar
                      (onSelect)="onDateChange($event)"
                      formControlName="date"
                      [locale]="transDate.he"
                      [placeholder]="'תאריך איסוף' | translate"
                      [showIcon]="true"
                      [touchUI]="true"
                      [dir]="'rtl'"
                      [minDate]="mindate"
                      [disabledDays]="[6]"
                      dateFormat="dd/mm/yy"
                      [disabledDates]="disabledDates"
                    ></p-calendar>
                  </div>
                  <!-- <mat-form-field dir="ltr">
                    <mat-label>{{ 'תאריך איסוף' | translate }}</mat-label>
                    <input
                      [min]="mindate"
                      matInput
                      formControlName="date"
                      [matDatepicker]="picker"
                      disabled
                    />
                    <mat-datepicker-toggle
                      matSuffix
                      [for]="picker"
                    ></mat-datepicker-toggle>
                    <mat-datepicker
                      touchUi
                      #picker
                      disabled="false"
                    ></mat-datepicker>
                  </mat-form-field> -->

                  <div class="form-site__fields-wrap">
                    <div class="form-site__time">
                      <div class="input-time">
                        <div class="timeNotice h4">
                          <span class="red">*</span
                          >{{ "payment.isufNotice" | translate }}
                        </div>
                        <!-- <div class="input-time__head"><span class="input-time__head-text">{{ orderForm.get('deliveryDetails.hours').value.length > 0 ? orderForm.get('deliveryDetails.hours').value : timeOfDeliveryAndPickup.defaultPickup[curLang] }}</span>
                                                </div> -->
                        <!-- <span class="form-site__error"
                              *ngIf="!f.deliveryDetails.get('hours').valid"> {{ "payment.form.validationErrors.requiredHour" | translate }} </span> -->
                        <!-- <div class="input-time__content">
                                                    <div class="input-time__list">
                                                        <div class="input-time__item" (click)="orderForm.controls['deliveryDetails'].controls['hours'].setValue(timeOfDeliveryAndPickup.morning[curLang])"> {{timeOfDeliveryAndPickup.morning[curLang]}} </div>
                                                        <div class="input-time__item" (click)="orderForm.controls['deliveryDetails'].controls['hours'].setValue(timeOfDeliveryAndPickup.evening[curLang])"> {{timeOfDeliveryAndPickup.evening[curLang]}} </div>
                                                        <div class="input-time__item" (click)="orderForm.controls['deliveryDetails'].controls['hours'].setValue(timeOfDeliveryAndPickup.everyTime[curLang])"> {{timeOfDeliveryAndPickup.everyTime[curLang]}} </div>
                                                    </div>
                                                </div> -->
                      </div>
                    </div>
                  </div>

                  <div class="form-site__field">
                    <label for="spec-req" class="form-site__label">{{
                      "payment.form.additionalRequests" | translate
                    }}</label>
                    <input
                      class="mobile-indent"
                      type="text"
                      placeholder=""
                      id="spec-req"
                      maxlength="100"
                      formControlName="specialRequests"
                    />
                  </div>

                  <div class="form-site__limit">
                    <span
                      >{{
                        "payment.form.additionalRequestsNotice" | translate
                      }} </span
                    >{{
                      100 -
                        orderForm.get("deliveryDetails.specialRequests").value
                          .length
                    }}
                  </div>

                  <div class="form-site__comment">
                    {{ "payment.form.pickupNotice" | translate }}
                  </div>
                </div>
              </div>
              <!-- isuf acmi pratim end -->

              <!-- mishloah pratim start -->

              <div
                class="payment-form-step__item"
                formGroupName="deliveryDetails"
                *ngIf="
                  orderForm.get('deliveryDetails.deliveryType').value ===
                  _deliveryType.delivery
                "
              >
                <div
                  class="payment-form-step__title"
                  [ngStyle]="{
                    color:
                      f.deliveryDetails.get('date').valid &&
                      f.deliveryDetails.get('hours').valid
                        ? 'green'
                        : 'red'
                  }"
                >
                  {{ "payment.form.deliveryDetails" | translate }}
                </div>

                <div class="payment-form-step__form">
                  <div style="display: flex">
                    <div class="p-field p-col-12 p-md-4" dir="rtl">
                      <p-calendar
                        (onSelect)="onDateChange($event)"
                        formControlName="date"
                        [locale]="transDate.he"
                        [placeholder]="'תאריך משלוח' | translate"
                        [showIcon]="true"
                        [touchUI]="true"
                        [dir]="'rtl'"
                        [minDate]="mindate"
                        [disabledDays]="[6]"
                        dateFormat="dd/mm/yy"
                        [disabledDates]="disabledDates"
                      ></p-calendar>
                    </div>
                    <!-- <div [hidden]="!timeOver" class="css-time-over">
                                            {{ 'payment.overTime' | translate: { 'phone': store.tel } }}

                                        </div> -->
                  </div>
                  <div class="form-site__fields-wrap">
                    <div class="form-site__time">
                      <div class="input-time">
                        <div class="timeNotice h4">
                          <span class="red">*</span
                          >{{ "payment.notice" | translate }}
                        </div>
                        <div class="input-time__head">
                          <span class="input-time__head-text">{{
                            orderForm.get("deliveryDetails.hours").value
                              .length > 0
                              ? orderForm.get("deliveryDetails.hours").value
                              : timeOfDeliveryAndPickup.defaultDelivery[curLang]
                          }}</span>
                        </div>
                        <!-- <div class="input-time__head"><span class="input-time__head-text">תיאום זמן משלוח</span></div> -->
                        <!-- <span class="form-site__error"
                              *ngIf="!f.deliveryDetails.get('hours').valid"> {{ "payment.form.validationErrors.requiredHour" | translate }} </span> -->
                        <div class="input-time__content">
                          <div class="input-time__list">
                            <!-- <div class="input-time__item"
                                 (click)="orderForm.controls['deliveryDetails'].controls['hours'].setValue(timeOfDeliveryAndPickup.morning[curLang])"> {{timeOfDeliveryAndPickup.morning[curLang]}} </div>
                            <div class="input-time__item"
                                 (click)="orderForm.controls['deliveryDetails'].controls['hours'].setValue(timeOfDeliveryAndPickup.evening[curLang])"> {{timeOfDeliveryAndPickup.evening[curLang]}} </div>
                            <div class="input-time__item"
                                 (click)="orderForm.controls['deliveryDetails'].controls['hours'].setValue(timeOfDeliveryAndPickup.everyTime[curLang])"> {{timeOfDeliveryAndPickup.everyTime[curLang]}} </div> -->
                            <div
                              class="input-time__item"
                              (click)="
                                orderForm.controls['deliveryDetails'].controls[
                                  'hours'
                                ].setValue(
                                  timeOfDeliveryAndPickup.morning[curLang]
                                )
                              "
                            >
                              לתאם מסירה בתיאום טלפוני
                            </div>
                            <div
                              class="input-time__item"
                              (click)="
                                orderForm.controls['deliveryDetails'].controls[
                                  'hours'
                                ].setValue(
                                  timeOfDeliveryAndPickup.evening[curLang]
                                )
                              "
                            >
                              המשלוח יגיע במהלך היום
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="form-site__field">
                    <div class="textarea-block">
                      <label for="comment" class="textarea-block__label">{{
                        "payment.form.blessing" | translate
                      }}</label>
                      <textarea
                        id="comment"
                        maxlength="500"
                        formControlName="blessing"
                      ></textarea>
                    </div>
                  </div>
                  <div class="form-site__limit">
                    <span>{{ "payment.form.blessingNotice" | translate }}</span>
                    {{
                      500 -
                        orderForm.get("deliveryDetails.blessing").value.length
                    }}
                  </div>

                  <div class="payment__special">
                    <div class="form-site__field">
                      <label for="spec-req" class="form-site__label">{{
                        "payment.form.additionalRequests" | translate
                      }}</label>
                      <input
                        type="text"
                        placeholder=""
                        id="spec-req"
                        maxlength="100"
                        formControlName="specialRequests"
                      />
                    </div>

                    <div class="form-site__limit">
                      <span
                        >{{
                          "payment.form.additionalRequestsNotice" | translate
                        }} </span
                      >{{
                        100 -
                          orderForm.get("deliveryDetails.specialRequests").value
                            .length
                      }}
                    </div>
                  </div>
                </div>
              </div>
              <!-- mishloah pratim end -->

              <div
                class="payment-form-step__item payment-form-step__item--no-bottom"
                formGroupName="deliveryDetails"
                *ngIf="
                  orderForm.get('deliveryDetails.deliveryType').value ===
                  _deliveryType.delivery
                "
              >
                <div
                  class="payment-form-step__title"
                  [ngStyle]="{
                    color: f.deliveryDetails.get('recipient').valid
                      ? 'green'
                      : 'red'
                  }"
                >
                  {{ "payment.form.receiverDetails" | translate }}
                </div>

                <div class="payment-form-step__form" formGroupName="recipient">
                  <div class="form-site__field">
                    <label for="name" class="form-site__label">{{
                      "payment.form.fullName" | translate
                    }}</label>
                    <input
                      type="text"
                      formControlName="fullName"
                      placeholder="הזינו שם מלא"
                      id="name"
                    />
                  </div>

                  <div class="form-site__field">
                    <label for="mobile" class="form-site__label">{{
                      "payment.form.mobile" | translate
                    }}</label>
                    <input
                      type="text"
                      formControlName="mobile"
                      placeholder=""
                      id="mobile"
                    />
                  </div>
                </div>
              </div>

              <div
                class="payment-form-step__item payment-form-step__item--no-top"
                formGroupName="deliveryAddress"
                *ngIf="
                  orderForm.get('deliveryDetails.deliveryType').value ===
                  _deliveryType.delivery
                "
              >
                <div
                  class="payment-form-step__title d-md-none"
                  [ngStyle]="{
                    color: f.deliveryAddress.valid ? 'green' : 'red'
                  }"
                >
                  {{ "payment.form.receiverAddress" | translate }}
                </div>

                <div class="payment-form-step__form">
                  <div class="payment-office">
                    <div class="input-check">
                      <input
                        type="checkbox"
                        id="checkbox2"
                        (change)="
                          onOfficeOwnerTypeChanged(
                            $event,
                            _destinationType.private
                          )
                        "
                        [checked]="
                          orderForm.get('deliveryAddress.destinationType')
                            .value === _destinationType.private
                            ? 'checked'
                            : ''
                        "
                      />
                      <label for="checkbox2" class="input-check__label"
                        ><span class="input-check__mark"></span>
                        <span class="input-check__text">{{
                          "payment.form.deliveryAddress.owen" | translate
                        }}</span>
                      </label>
                    </div>

                    <div class="input-check">
                      <input
                        type="checkbox"
                        id="checkbox3"
                        (change)="
                          onOfficeOwnerTypeChanged(
                            $event,
                            _destinationType.office
                          )
                        "
                        [checked]="
                          orderForm.get('deliveryAddress.destinationType')
                            .value === _destinationType.office
                            ? 'checked'
                            : ''
                        "
                      />
                      <label for="checkbox3" class="input-check__label"
                        ><span class="input-check__mark"></span>
                        <span class="input-check__text">{{
                          "payment.form.deliveryAddress.office" | translate
                        }}</span></label
                      >
                    </div>

                    <div
                      class="form-site__field"
                      *ngIf="
                        orderForm.get('deliveryAddress.destinationType')
                          .value === _destinationType.office
                      "
                    >
                      <input
                        type="text"
                        formControlName="companyName"
                        placeholder="{{
                          'payment.form.deliveryAddress.officeName' | translate
                        }}"
                        id="office"
                      />
                    </div>
                  </div>

                  <div class="form-site__field form-site__field-city">
                    <label for="mobile" class="form-site__label">{{
                      "payment.form.deliveryAddress.city" | translate
                    }}</label>
                    <div class="select">
                      <div class="select__cur">{{ city.name[curLang] }}</div>
                      <div class="select__list">
                        <div
                          class="select__item"
                          (click)="onCityChanged(dest)"
                          [ngClass]="{ active: city._id === dest._id }"
                          *ngFor="let dest of deliveryCities"
                        >
                          {{ dest.name[curLang] }}
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="form-site__field">
                    <label for="street" class="form-site__label">{{
                      "payment.form.deliveryAddress.street" | translate
                    }}</label>
                    <input
                      type="text"
                      formControlName="street"
                      placeholder=""
                      id="street"
                    />
                  </div>

                  <div class="form-site__fields-wrap">
                    <div class="form-site__field">
                      <label for="house" class="form-site__label">{{
                        "payment.form.deliveryAddress.number" | translate
                      }}</label>
                      <input
                        type="text"
                        formControlName="house"
                        placeholder=""
                        id="house"
                      />
                    </div>

                    <div class="form-site__field">
                      <label for="flat" class="form-site__label">{{
                        "payment.form.deliveryAddress.apartment" | translate
                      }}</label>
                      <input
                        type="text"
                        formControlName="apartment"
                        placeholder=""
                        id="flat"
                      />
                    </div>

                    <div class="form-site__field">
                      <label for="floor" class="form-site__label">{{
                        "payment.form.deliveryAddress.floor" | translate
                      }}</label>
                      <input
                        type="text"
                        formControlName="floor"
                        placeholder=""
                        id="floor"
                      />
                    </div>
                  </div>

                  <div class="form-site__field">
                    <input
                      type="text"
                      formControlName="instructions"
                      placeholder="{{
                        'payment.form.deliveryAddress.additional' | translate
                      }}"
                      id="instruction"
                    />
                  </div>
                </div>
              </div>

              <div
                class="payment-form-step__item"
                formGroupName="customerDetails"
              >
                <div
                  class="payment-form-step__title"
                  [ngStyle]="{
                    color: f.customerDetails.valid ? 'green' : 'red'
                  }"
                >
                  {{ "payment.form.creditCardBtn" | translate }}
                </div>

                <div class="payment-form-step__form">
                  <div class="payment-select">
                    <div class="payment-select__list">
                      <div
                        class="payment-select__item-wrap"
                        *ngIf="
                          store.payments.indexOf(_paymentType.creditCard) > -1
                        "
                      >
                        <a
                          class="payment-select__item"
                          [ngClass]="{
                            active: paymentType === _paymentType.creditCard
                          }"
                          (click)="paymentType = _paymentType.creditCard"
                          >{{ "payment.creditCard" | translate }}</a
                        >
                        <div class="payment-select__popup">
                          {{ "payment.form.payPhonePopup" | translate }}
                        </div>
                        <!--<div class="payment-select__popup">חסר: שם פרטי, שם משפחה, טלפון, דוא"ל</div>-->
                      </div>

                      <div
                        class="payment-select__item-wrap"
                        *ngIf="store.payments.indexOf(_paymentType.phone) > -1"
                      >
                        <a
                          class="payment-select__item"
                          [ngClass]="{
                            active: paymentType === _paymentType.phone
                          }"
                          (click)="paymentType = _paymentType.phone"
                          >{{ "payment.phone" | translate }}</a
                        >
                        <div class="payment-select__popup">
                          {{ "payment.form.creditCardPopup" | translate }}
                        </div>
                        <!--<div class="payment-select__popup">חסר: שם פרטי, שם משפחה, טלפון, דוא"ל</div>-->
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="form-site-criterion__list">
                <h2 class="form-site-criterion__label">
                  חובה למלא את השדות המודגשים באדום.
                </h2>
                <div
                  class="form-site-criterion__item"
                  *ngIf="!f.customerDetails.get('fullName').valid"
                >
                  <span class="form-site-criterion__tick">{{
                    "payment.form.validationText.x" | translate
                  }}</span>
                  {{ "payment.form.validationText.name" | translate }}
                </div>

                <div
                  class="form-site-criterion__item form-site-criterion__item--true"
                  *ngIf="f.customerDetails.get('fullName').valid"
                >
                  <span class="form-site-criterion__tick">{{
                    "payment.form.validationText.v" | translate
                  }}</span>
                  {{ "payment.form.validationText.name" | translate }}
                </div>

                <div
                  class="form-site-criterion__item"
                  *ngIf="!f.customerDetails.get('mobile').valid"
                >
                  <span class="form-site-criterion__tick">{{
                    "payment.form.validationText.x" | translate
                  }}</span>
                  {{ "payment.form.validationText.tel" | translate }}
                </div>

                <div
                  class="form-site-criterion__item form-site-criterion__item--true"
                  *ngIf="f.customerDetails.get('mobile').valid"
                >
                  <span class="form-site-criterion__tick">{{
                    "payment.form.validationText.v" | translate
                  }}</span>
                  {{ "payment.form.validationText.tel" | translate }}
                </div>

                <div
                  class="form-site-criterion__item"
                  *ngIf="!f.customerDetails.get('email').valid"
                >
                  <span class="form-site-criterion__tick">{{
                    "payment.form.validationText.x" | translate
                  }}</span>
                  {{ "payment.form.validationText.email" | translate }}
                </div>

                <div
                  class="form-site-criterion__item form-site-criterion__item--true"
                  *ngIf="f.customerDetails.get('email').valid"
                >
                  <span class="form-site-criterion__tick">{{
                    "payment.form.validationText.v" | translate
                  }}</span>
                  {{ "payment.form.validationText.email" | translate }}
                </div>

                <div
                  class="form-site-criterion__item"
                  *ngIf="
                    !f.deliveryDetails.get('blessing').valid &&
                    _deliveryType.delivery ===
                      orderForm.get('deliveryDetails.deliveryType').value
                  "
                >
                  <span class="form-site-criterion__tick">{{
                    "payment.form.validationText.x" | translate
                  }}</span>
                  {{ "payment.form.validationText.blessingText" | translate }}
                </div>

                <div
                  class="form-site-criterion__item form-site-criterion__item--true"
                  *ngIf="
                    f.deliveryDetails.get('blessing').valid &&
                    _deliveryType.delivery ===
                      orderForm.get('deliveryDetails.deliveryType').value
                  "
                >
                  <span class="form-site-criterion__tick">{{
                    "payment.form.validationText.v" | translate
                  }}</span>
                  {{ "payment.form.validationText.blessingText" | translate }}
                </div>

                <div
                  class="form-site-criterion__item"
                  *ngIf="!f.deliveryDetails.get('date').valid"
                >
                  <span class="form-site-criterion__tick">{{
                    "payment.form.validationText.x" | translate
                  }}</span>
                  {{ "payment.form.validationText.date" | translate }}
                </div>

                <div
                  class="form-site-criterion__item form-site-criterion__item--true"
                  *ngIf="f.deliveryDetails.get('date').valid"
                >
                  <span class="form-site-criterion__tick">{{
                    "payment.form.validationText.v" | translate
                  }}</span>
                  {{ "payment.form.validationText.date" | translate }}
                </div>

                <div
                  class="form-site-criterion__item"
                  *ngIf="!f.deliveryDetails.get('hours').valid"
                >
                  <span class="form-site-criterion__tick">{{
                    "payment.form.validationText.x" | translate
                  }}</span>
                  {{ "payment.form.validationErrors.requiredHour" | translate }}
                </div>

                <div
                  class="form-site-criterion__item form-site-criterion__item--true"
                  *ngIf="f.deliveryDetails.get('hours').valid"
                >
                  <span class="form-site-criterion__tick">{{
                    "payment.form.validationText.v" | translate
                  }}</span>
                  {{ "payment.form.validationErrors.requiredHour" | translate }}
                </div>

                <ng-container
                  *ngIf="
                    _deliveryType.delivery ===
                    orderForm.get('deliveryDetails.deliveryType').value
                  "
                >
                  <div
                    class="form-site-criterion__item"
                    *ngIf="!f.deliveryDetails.get('recipient.fullName').valid"
                  >
                    <span class="form-site-criterion__tick">{{
                      "payment.form.validationText.x" | translate
                    }}</span>
                    {{
                      "payment.form.validationText.recipientName" | translate
                    }}
                  </div>

                  <div
                    class="form-site-criterion__item form-site-criterion__item--true"
                    *ngIf="f.deliveryDetails.get('recipient.fullName').valid"
                  >
                    <span class="form-site-criterion__tick">{{
                      "payment.form.validationText.v" | translate
                    }}</span>
                    {{
                      "payment.form.validationText.recipientName" | translate
                    }}
                  </div>

                  <div
                    class="form-site-criterion__item"
                    *ngIf="!f.deliveryDetails.get('recipient.mobile').valid"
                  >
                    <span class="form-site-criterion__tick">{{
                      "payment.form.validationText.x" | translate
                    }}</span>
                    {{ "payment.form.validationText.recipientTel" | translate }}
                  </div>

                  <div
                    class="form-site-criterion__item form-site-criterion__item--true"
                    *ngIf="f.deliveryDetails.get('recipient.mobile').valid"
                  >
                    <span class="form-site-criterion__tick">{{
                      "payment.form.validationText.v" | translate
                    }}</span>
                    {{ "payment.form.validationText.recipientTel" | translate }}
                  </div>

                  <div
                    class="form-site-criterion__item form-site-criterion__item--true"
                    *ngIf="f.deliveryAddress.get('street').valid"
                  >
                    <span class="form-site-criterion__tick">{{
                      "payment.form.validationText.v" | translate
                    }}</span>
                    {{ "payment.form.validationText.street" | translate }}
                  </div>

                  <div
                    class="form-site-criterion__item"
                    *ngIf="!f.deliveryAddress.get('street').valid"
                  >
                    <span class="form-site-criterion__tick">{{
                      "payment.form.validationText.x" | translate
                    }}</span>
                    {{ "payment.form.validationText.street" | translate }}
                  </div>

                  <div
                    class="form-site-criterion__item form-site-criterion__item--true"
                    *ngIf="f.deliveryAddress.get('house').valid"
                  >
                    <span class="form-site-criterion__tick">{{
                      "payment.form.validationText.v" | translate
                    }}</span>
                    {{ "payment.form.validationText.house" | translate }}
                  </div>
                  <div
                    class="form-site-criterion__item"
                    *ngIf="!f.deliveryAddress.get('house').valid"
                  >
                    <span class="form-site-criterion__tick">{{
                      "payment.form.validationText.x" | translate
                    }}</span>
                    {{ "payment.form.validationText.house" | translate }}
                  </div>
                  <!-- <div class="form-site-criterion__item form-site-criterion__item--true" *ngIf="f.deliveryAddress.get('apartment').valid">
                                      <span class="form-site-criterion__tick ">{{ "payment.form.validationText.v" | translate }}</span> {{ "payment.form.validationText.apartment" | translate }}
                                  </div> -->
                  <!-- <div class="form-site-criterion__item" *ngIf="!f.deliveryAddress.get('apartment').valid">
                                      <span class="form-site-criterion__tick ">{{ "payment.form.validationText.x" | translate }}</span> {{ "payment.form.validationText.apartment" | translate }}
                                  </div> -->
                </ng-container>
              </div>

              <button
                *ngIf="pack.baseItem.inStock"
                type="button"
                (click)="toPayment()"
                class="btn btn--blue"
                [disabled]="orderForm.invalid || disableButton"
                [ngClass]="{
                  'btn--disabled': orderForm.invalid || disableButton
                }"
              >
                {{ "המשך לתשלום >>" | translate }}
              </button>
              <button
                *ngIf="!pack.baseItem.inStock"
                type="button"
                class="btn btn--blue btn--disabled"
                [disabled]="true"
              >
                {{ "המוצר לא נמצה במלאי" | translate }}
              </button>
            </ng-container>

            <div class="form-site__sect">
              <div class="payment-form-step">
                <ng-container *ngIf="step === 2">
                  <div class="payment-form-step__item">
                    <div
                      class="payment-form-step__title"
                      [ngStyle]="{
                        color: f.customerDetails.valid ? 'green' : 'red'
                      }"
                    >
                      {{
                        "payment.form.deliveryAddress.selectPaymentType"
                          | translate
                      }}
                    </div>

                    <div class="payment-form-step__form">
                      <div class="payment-select">
                        <div class="payment-select__list">
                          <a
                            class="payment-select__item"
                            *ngIf="
                              store.payments.indexOf(_paymentType.creditCard) >
                              -1
                            "
                            [ngClass]="{
                              active: paymentType === _paymentType.creditCard
                            }"
                            (click)="paymentType = _paymentType.creditCard"
                            >{{ "payment.creditCard" | translate }}</a
                          >
                          <a
                            class="payment-select__item"
                            *ngIf="
                              store.payments.indexOf(_paymentType.phone) > -1
                            "
                            [ngClass]="{
                              active: paymentType === _paymentType.phone
                            }"
                            (click)="paymentType = _paymentType.phone"
                            >{{ "payment.phone" | translate }}</a
                          >
                          <!--<a href="#" class="payment-select__item payment-select__item&#45;&#45;img"><img src="img/google-pay.jpg"
                                                                                                  alt=""></a>
                          <a href="#" class="payment-select__item payment-select__item&#45;&#45;img"><img src="img/paypal.jpg" alt=""></a>-->
                        </div>
                        <br />
                        <div
                          *ngIf="paymentType === _paymentType.phone"
                          class="payment-select__text"
                        >
                          {{ "payment.phoneNotice" | translate }}
                        </div>
                        <br />
                        <br />
                      </div>

                      <ng-container formGroupName="phonePaymentDetails">
                        <ng-container
                          *ngIf="
                            _paymentType.phone === paymentType &&
                            store.payments.indexOf(_paymentType.phone) > -1
                          "
                        >
                          <div class="form-site__field">
                            <label for="name" class="form-site__label">
                              {{ "payment.form.fullName" | translate }}
                            </label>
                            <input
                              type="text"
                              formControlName="fullName"
                              placeholder="הזינו שם\חברה להציג בחשבונית"
                              id="name"
                            />
                          </div>

                          <div class="form-site__field">
                            <label for="mobile" class="form-site__label">{{
                              "payment.form.mobile" | translate
                            }}</label>
                            <input
                              type="text"
                              formControlName="mobile"
                              placeholder=""
                              id="mobile"
                            />
                          </div>

                          <div class="form-site__explan">
                            {{ "payment.form.phonePaymentNotice" | translate }}
                          </div>

                          <div class="form-site__field">
                            <label for="email" class="form-site__label">{{
                              "payment.form.mail" | translate
                            }}</label>
                            <input
                              type="email"
                              formControlName="email"
                              placeholder=""
                              id="email"
                            />
                          </div>

                          <div class="payment-result">
                            {{ "payment.form.sumForPayment" | translate }} ₪{{
                              orderForm.get("deliveryDetails.deliveryType")
                                .value === _deliveryType.pickup
                                ? store.getPackagePrice(pack)
                                : store.getPackagePriceWithDelivery(
                                    pack,
                                    city._id
                                  )
                            }}
                          </div>

                          <button
                            type="submit"
                            *ngIf="paymentType === _paymentType.phone"
                            [disabled]="orderForm.invalid"
                            [ngClass]="{
                              'btn--disabled': f.phonePaymentDetails.invalid
                            }"
                            class="btn btn--blue"
                          >
                            {{ "payment.form.submitButton" | translate }}
                          </button>
                          <!--<div class="form-site__inscript">על ידי הזמנה זו, אני מסכים עם <a href="#">תנאי שימוש</a> והפרטיות
                            של
                            האתרה
                          </div>-->
                        </ng-container>

                        <ng-container
                          *ngIf="
                            _paymentType.creditCard === paymentType &&
                            store.payments.indexOf(_paymentType.creditCard) > -1
                          "
                        >
                          <iframe
                            #financeiFrame
                            (load)="onLoadFunc(financeiFrame)"
                            style="width: 100%; height: 650px"
                            frameBorder="0"
                            [src]="iframeUrl"
                          ></iframe>
                        </ng-container>
                      </ng-container>
                    </div>
                  </div>
                </ng-container>
              </div>
              <!-- end payment-form-step -->
            </div>
          </form>
        </div>
        <!-- end payment-form -->
      </div>
    </div>
  </div>
</main>
<app-footer></app-footer>
